<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.319">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>brms_poweranalysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="brms_powerAnalysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="brms_powerAnalysis_files/libs/quarto-html/quarto.js"></script>
<script src="brms_powerAnalysis_files/libs/quarto-html/popper.min.js"></script>
<script src="brms_powerAnalysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="brms_powerAnalysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="brms_powerAnalysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="brms_powerAnalysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="brms_powerAnalysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="brms_powerAnalysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="brms_powerAnalysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading 'brms' package (version 2.19.0). Useful instructions
can be found by typing help('brms'). A more detailed introduction
to the package is available through vignette('brms_overview').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'brms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    ar</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:magrittr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(faux)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
************
Welcome to faux. For support and examples visit:
https://debruine.github.io/faux/
- Get and set global package options with: faux_options()
************</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidybayes'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:brms':

    dstudent_t, pstudent_t, qstudent_t, rstudent_t</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mediation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sandwich</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>mediation: Causal Mediation Analysis
Version: 4.5.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt) <span class="co"># tables printing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="generate-the-design" class="level2">
<h2 class="anchored" data-anchor-id="generate-the-design">Generate the design</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>gen_data <span class="ot">&lt;-</span> <span class="cf">function</span>(seed,n){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a> between <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">P =</span> <span class="fu">c</span>(<span class="st">"counter"</span>,<span class="st">"neutral"</span>,<span class="st">"fit"</span>)) </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a> <span class="do">## negative -&gt; counter</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a> <span class="do">## neutral -&gt; neutral</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a> <span class="do">## positive -&gt; fit</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a> <span class="do">## PF -&gt; dPT</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a> <span class="do">## dPO -&gt; exPO</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a> df <span class="ot">&lt;-</span> <span class="fu">sim_design</span>(<span class="fu">list</span>(), between, <span class="at">n =</span> n,<span class="at">plot=</span><span class="cn">FALSE</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a> df<span class="sc">$</span>dPT <span class="ot">=</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df), <span class="at">min =</span> <span class="dv">4</span>, <span class="at">max =</span> <span class="dv">7</span>) <span class="do">## 4 - 7 seconds</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a> df<span class="sc">$</span>exPO <span class="ot">=</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df), <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">2</span>)<span class="co">#rep(1:5,nrow(df)/5); coded as extremity</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a> df<span class="sc">$</span>J1  <span class="ot">=</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df), <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">5</span>)<span class="co">#rep(1:5,nrow(df)/5)</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a> df<span class="sc">$</span>J2  <span class="ot">=</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df), <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">5</span>)<span class="co">#rep(1:5,nrow(df)/5)</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a> df<span class="sc">$</span>J3  <span class="ot">=</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df), <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">5</span>)<span class="co">#rep(1:5,nrow(df)/5)</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a> df<span class="sc">$</span>J4  <span class="ot">=</span> <span class="fu">runif</span>(<span class="fu">nrow</span>(df), <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">5</span>)<span class="co">#rep(1:5,nrow(df)/5)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a> df</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">gen_data</span>(<span class="dv">1</span>,<span class="dv">100</span>) <span class="co"># 100 subjects per group</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id       P          y      dPT      exPO       J1       J2       J3
1 S001 counter -0.6264538 6.442755 1.6637980 2.466106 1.291509 1.246438
2 S002 counter  0.1836433 6.786332 1.5336855 3.965572 4.497235 2.421285
3 S003 counter -0.8356286 4.442443 0.5455606 4.734025 1.795491 3.308151
4 S004 counter  1.5952808 6.249465 0.3763266 3.692840 3.138359 3.140126
5 S005 counter  0.3295078 6.926972 0.4515237 3.805428 1.422249 3.417091
6 S006 counter -0.8204684 6.924377 0.1239407 4.390502 2.535980 2.944596
        J4
1 3.067001
2 3.632194
3 3.353586
4 1.319698
5 1.624545
6 4.940325</code></pre>
</div>
</div>
</section>
<section id="define-the-model" class="level2">
<h2 class="anchored" data-anchor-id="define-the-model">Define the model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(brms)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a> model_mediator1 <span class="ot">&lt;-</span> <span class="fu">bf</span>(dPT <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#model_mediator2 &lt;- bf(J1 ~ 1+P + PF, family = cumulative("logit"))</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a> model_mediator2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(J1 <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P <span class="sc">+</span> dPT)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a> model_mediator3 <span class="ot">&lt;-</span> <span class="fu">bf</span>(J2 <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P <span class="sc">+</span> dPT)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a> model_mediator4 <span class="ot">&lt;-</span> <span class="fu">bf</span>(J3 <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P <span class="sc">+</span> dPT)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a> model_mediator5 <span class="ot">&lt;-</span> <span class="fu">bf</span>(J4 <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P <span class="sc">+</span> dPT)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a> model_outcome  <span class="ot">&lt;-</span> <span class="fu">bf</span>(exPO <span class="sc">~</span> <span class="dv">0</span><span class="sc">+</span>P <span class="sc">+</span> dPT <span class="sc">+</span> J1<span class="sc">+</span>J2<span class="sc">+</span>J3<span class="sc">+</span>J4)<span class="co">#, family = cumulative("logit"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-the-priors" class="level2">
<h2 class="anchored" data-anchor-id="define-the-priors">Define the priors</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.2</span>,<span class="fl">0.1</span>), <span class="at">coef =</span> <span class="st">"Pcounter"</span>,<span class="at">resp=</span><span class="st">"dPT"</span>),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.0</span>,<span class="fl">0.00001</span>), <span class="at">coef =</span> <span class="st">"Pneutral"</span>,<span class="at">resp=</span><span class="st">"dPT"</span>), </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="fl">0.1</span>), <span class="at">coef =</span> <span class="st">"Pfit"</span>,<span class="at">resp=</span><span class="st">"dPT"</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pcounter"</span>,<span class="at">resp=</span><span class="st">"J1"</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.0</span>,<span class="fl">0.00005</span>), <span class="at">coef =</span> <span class="st">"Pneutral"</span>,<span class="at">resp=</span><span class="st">"J1"</span>),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pfit"</span>,<span class="at">resp=</span><span class="st">"J1"</span>),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">1.0</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"dPT"</span>,<span class="at">resp=</span><span class="st">"J1"</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pcounter"</span>,<span class="at">resp=</span><span class="st">"J2"</span>),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.0</span>,<span class="fl">0.00005</span>), <span class="at">coef =</span> <span class="st">"Pneutral"</span>,<span class="at">resp=</span><span class="st">"J2"</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pfit"</span>,<span class="at">resp=</span><span class="st">"J2"</span>),</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">1.0</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"dPT"</span>,<span class="at">resp=</span><span class="st">"J2"</span>),</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pcounter"</span>,<span class="at">resp=</span><span class="st">"J3"</span>),</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.0</span>,<span class="fl">0.00005</span>), <span class="at">coef =</span> <span class="st">"Pneutral"</span>,<span class="at">resp=</span><span class="st">"J3"</span>),</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pfit"</span>,<span class="at">resp=</span><span class="st">"J3"</span>),</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">1.0</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"dPT"</span>,<span class="at">resp=</span><span class="st">"J3"</span>),</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pcounter"</span>,<span class="at">resp=</span><span class="st">"J4"</span>),</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.0</span>,<span class="fl">0.00005</span>), <span class="at">coef =</span> <span class="st">"Pneutral"</span>,<span class="at">resp=</span><span class="st">"J4"</span>),</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pfit"</span>,<span class="at">resp=</span><span class="st">"J4"</span>),</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">1.0</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"dPT"</span>,<span class="at">resp=</span><span class="st">"J4"</span>),</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="fl">0.25</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pcounter"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>),</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.0</span> ,<span class="fl">0.00005</span>), <span class="at">coef =</span> <span class="st">"Pneutral"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>),</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.25</span>,<span class="fl">0.5</span>), <span class="at">coef =</span> <span class="st">"Pfit"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>),</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.4</span>,<span class="fl">0.4</span>), <span class="at">coef =</span> <span class="st">"J1"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>), <span class="co">#</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.2</span>,<span class="fl">0.2</span>), <span class="at">coef =</span> <span class="st">"J2"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>), <span class="co">#</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.2</span>,<span class="fl">0.2</span>), <span class="at">coef =</span> <span class="st">"J3"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>), <span class="co">#</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="fl">0.2</span>,<span class="fl">0.2</span>), <span class="at">coef =</span> <span class="st">"J4"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>), <span class="co">#</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>( <span class="dv">0</span> ,<span class="fl">0.1</span>), <span class="at">coef =</span> <span class="st">"dPT"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>),</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">"sigma"</span>,<span class="at">resp=</span><span class="st">"exPO"</span>),</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">"sigma"</span>,<span class="at">resp=</span><span class="st">"J1"</span>),</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">"sigma"</span>,<span class="at">resp=</span><span class="st">"J2"</span>),</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">"sigma"</span>,<span class="at">resp=</span><span class="st">"J3"</span>),</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">class =</span> <span class="st">"sigma"</span>,<span class="at">resp=</span><span class="st">"J4"</span>),</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>     <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>), <span class="at">class =</span> <span class="st">"sigma"</span>,<span class="at">resp=</span><span class="st">"dPT"</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sample-parameters-from-the-prior" class="level2">
<h2 class="anchored" data-anchor-id="sample-parameters-from-the-prior">Sample parameters from the prior</h2>
<p>We once need to sample the model to get the actual parameters. We can reuse the model later to fit those parameters and check how often we can come to the correct conclusions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># J1 =&gt; Truth</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># J2 =&gt; Trust</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># J3 =&gt; Familiarity</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># J4 =&gt; Likeability</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a> med_prior <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>   model_mediator1 <span class="sc">+</span> model_mediator2  <span class="sc">+</span> model_mediator3 <span class="sc">+</span> model_mediator4 <span class="sc">+</span>  model_mediator5<span class="sc">+</span> model_outcome <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>), </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">prior =</span> priors,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> df, <span class="at">sample_prior=</span><span class="st">"only"</span>,<span class="at">cores=</span><span class="dv">4</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">refresh=</span><span class="dv">0</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>med_model <span class="ot">=</span> <span class="fu">brm</span>(</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>   model_mediator1 <span class="sc">+</span> model_mediator2 <span class="sc">+</span> model_mediator3 <span class="sc">+</span> model_mediator4 <span class="sc">+</span>  model_mediator5 <span class="sc">+</span> model_outcome <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>), </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> df,<span class="at">cores=</span><span class="dv">4</span>,<span class="at">chains=</span><span class="dv">4</span>,<span class="at">refresh=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generate-the-prior-distribution" class="level2">
<h2 class="anchored" data-anchor-id="generate-the-prior-distribution">Generate the Prior Distribution</h2>
<div class="{callout-note}">
<p>We generate 50 predictions based on the prior and visualize the data we get.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>  f_dPT <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P),<span class="at">resp=</span><span class="st">"dPT"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids =</span> <span class="dv">6</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>f_dPT <span class="ot">=</span> f_dPT[<span class="dv">1</span>,]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x=</span>f_dPT,<span class="at">color=</span>P))<span class="sc">+</span><span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>iterative_draw_posterior <span class="ot">=</span> <span class="cf">function</span>(med_prior,df,draw_id){</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  f_dPT <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P),<span class="at">resp=</span><span class="st">"dPT"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids=</span>draw_id)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  f_j1 <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P,<span class="at">dPT=</span>f_dPT[<span class="dv">1</span>,]),<span class="at">resp=</span><span class="st">"J1"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids=</span>draw_id)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  f_j2 <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P,<span class="at">dPT=</span>f_dPT[<span class="dv">1</span>,]),<span class="at">resp=</span><span class="st">"J2"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids=</span>draw_id)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  f_j3 <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P,<span class="at">dPT=</span>f_dPT[<span class="dv">1</span>,]),<span class="at">resp=</span><span class="st">"J3"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids=</span>draw_id)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  f_j4 <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P,<span class="at">dPT=</span>f_dPT[<span class="dv">1</span>,]),<span class="at">resp=</span><span class="st">"J4"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids=</span>draw_id)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  f_exPO <span class="ot">=</span> <span class="fu">posterior_predict</span>(med_prior,<span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P,<span class="at">dPT=</span>f_dPT[<span class="dv">1</span>,],<span class="at">J1=</span>f_j1[<span class="dv">1</span>,],<span class="at">J2=</span>f_j2[<span class="dv">1</span>,],<span class="at">J3=</span>f_j3[<span class="dv">1</span>,],<span class="at">J4=</span>f_j4[<span class="dv">1</span>,]),<span class="at">resp=</span><span class="st">"exPO"</span>,<span class="at">summary=</span><span class="cn">FALSE</span>,<span class="at">draw_ids=</span>draw_id)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">P=</span>df<span class="sc">$</span>P,<span class="at">dPT=</span>f_dPT[<span class="dv">1</span>,],<span class="at">J1=</span>f_j1[<span class="dv">1</span>,],<span class="at">J2=</span>f_j2[<span class="dv">1</span>,],<span class="at">J3=</span>f_j3[<span class="dv">1</span>,],<span class="at">J4=</span>f_j4[<span class="dv">1</span>,],<span class="at">exPO=</span>f_exPO[<span class="dv">1</span>,],<span class="at">draw_ids =</span> draw_id))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>df_prior <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ix <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>){</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(ix)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  df_prior <span class="ot">=</span> <span class="fu">rbind</span>(df_prior,<span class="fu">iterative_draw_posterior</span>(med_prior,df,ix))</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>7</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>8</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>9</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>11</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>12</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>13</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>14</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>15</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>16</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>18</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>19</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>20</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>21</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>22</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>23</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>24</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(df_prior)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        P     dPT         J1        J2        J3        J4      exPO draw_ids
1 counter 1.05035 -0.2964766 -1.068725 -1.121192 -1.154921 -0.507282        1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>med_prior</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: MV(gaussian, gaussian, gaussian, gaussian, gaussian, gaussian) 
  Links: mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity
         mu = identity; sigma = identity 
Formula: dPT ~ 0 + P 
         J1 ~ 0 + P + dPT 
         J2 ~ 0 + P + dPT 
         J3 ~ 0 + P + dPT 
         J4 ~ 0 + P + dPT 
         exPO ~ 0 + P + dPT + J1 + J2 + J3 + J4 
   Data: df (Number of observations: 300) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
dPT_Pcounter      0.20      0.10    -0.00     0.40 1.00     4160     2481
dPT_Pneutral     -0.00      0.00    -0.00     0.00 1.00     3641     2793
dPT_Pfit         -0.20      0.10    -0.39    -0.01 1.00     3948     3075
J1_Pcounter      -0.50      0.49    -1.48     0.47 1.00     4631     2743
J1_Pneutral      -0.00      0.00    -0.00     0.00 1.00     4080     2312
J1_Pfit           0.49      0.50    -0.48     1.47 1.00     3952     3107
J1_dPT           -1.00      0.49    -1.97    -0.06 1.00     4158     2836
J2_Pcounter      -0.49      0.51    -1.49     0.50 1.00     3152     2163
J2_Pneutral       0.00      0.00    -0.00     0.00 1.00     4289     2244
J2_Pfit           0.50      0.49    -0.44     1.48 1.00     4548     2743
J2_dPT           -1.01      0.49    -1.97    -0.03 1.00     3998     2814
J3_Pcounter      -0.50      0.50    -1.50     0.49 1.00     3722     2887
J3_Pneutral      -0.00      0.00    -0.00     0.00 1.00     4309     2580
J3_Pfit           0.50      0.49    -0.44     1.46 1.00     4863     3442
J3_dPT           -1.00      0.51    -2.01    -0.02 1.00     5562     2993
J4_Pcounter      -0.50      0.50    -1.50     0.45 1.00     3919     3045
J4_Pneutral       0.00      0.00    -0.00     0.00 1.00     4248     2744
J4_Pfit           0.50      0.49    -0.47     1.44 1.00     4315     3001
J4_dPT           -1.00      0.51    -1.99    -0.00 1.00     5174     2685
exPO_Pcounter    -0.26      0.50    -1.25     0.70 1.00     4198     2868
exPO_Pneutral     0.00      0.00    -0.00     0.00 1.00     4045     1645
exPO_Pfit         0.25      0.49    -0.71     1.20 1.00     4574     2901
exPO_dPT         -0.00      0.10    -0.19     0.19 1.00     4464     3112
exPO_J1           0.40      0.40    -0.38     1.18 1.00     4456     3182
exPO_J2           0.20      0.20    -0.18     0.57 1.00     4130     3030
exPO_J3           0.20      0.20    -0.21     0.60 1.00     4225     2773
exPO_J4           0.20      0.21    -0.21     0.60 1.00     4393     2959

Family Specific Parameters: 
           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma_dPT      0.40      0.30     0.02     1.14 1.00     2285     1246
sigma_J1       0.80      0.60     0.03     2.26 1.00     2239     1482
sigma_J2       0.81      0.61     0.04     2.28 1.00     2269     1301
sigma_J3       0.79      0.60     0.03     2.19 1.00     1487      984
sigma_J4       0.79      0.59     0.03     2.22 1.00     2520     1087
sigma_exPO     0.77      0.61     0.02     2.26 1.00      755      588

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
</section>
<section id="initial-plotting" class="level2">
<h2 class="anchored" data-anchor-id="initial-plotting">Initial Plotting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(df_prior,aes(x=P,y=exPO))+geom_point(alpha=0.2) + stat_summary(color="red")</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(df_prior,aes(x=P,y=exPO))+stat_summary(position=position_nudge(x=0.1))+geom_point(alpha=0.2)</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(df_prior[df_prior$sample &lt; 50,],aes(x=dPT,color=as.factor(P),group=as.factor(sample)))+geom_density()</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">x=</span>dPT))<span class="sc">+</span><span class="fu">geom_histogram</span>()<span class="sc">+</span>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(dPT)),<span class="at">col=</span><span class="st">'red'</span>,<span class="at">linewidth=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">x=</span>J1,<span class="at">color=</span>P))<span class="sc">+</span><span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">x=</span>exPO,<span class="at">color=</span>P))<span class="sc">+</span><span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>J1,<span class="at">x=</span>dPT))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>J1,<span class="at">x=</span>J2))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>J3,<span class="at">x=</span>J2))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>J1,<span class="at">x=</span>exPO))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>J2,<span class="at">x=</span>exPO))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>J3,<span class="at">x=</span>exPO))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-9.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df_prior,<span class="fu">aes</span>(<span class="at">y=</span>dPT,<span class="at">x=</span>exPO))<span class="sc">+</span><span class="fu">stat_bin_hex</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-9-10.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot(df_prior,aes(y=exPO,x=J1,color=dPT))+geom_point()+facet_grid(0~P)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="power-analysis" class="level2">
<h2 class="anchored" data-anchor-id="power-analysis">Power analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>n_list <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">200</span>,<span class="dv">500</span>,<span class="dv">800</span>,<span class="dv">1000</span>,<span class="dv">2000</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#n_list = c(5)</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>runFun <span class="ot">&lt;-</span> <span class="cf">function</span>(seed,n){</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(seed)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  d_new <span class="ot">=</span> <span class="fu">gen_data</span>(<span class="dv">1</span>,<span class="at">n=</span>n)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  sim_y <span class="ot">=</span> <span class="fu">iterative_draw_posterior</span>(med_prior,d_new,seed)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  med_model <span class="ot">=</span> <span class="fu">update</span>(med_model,<span class="at">newdata =</span> sim_y,<span class="at">seed=</span>seed)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  fe <span class="ot">=</span> <span class="fu">fixef</span>(med_model)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  smpl <span class="ot">=</span> <span class="fu">as_draws_matrix</span>(med_model,<span class="at">variable=</span><span class="fu">c</span>(<span class="st">"b_J4_dPT"</span>,<span class="st">"b_dPT_Pfit"</span>,<span class="st">"b_exPO_J4"</span>))</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  fe <span class="ot">=</span> <span class="fu">rbind</span>(fe,<span class="st">"indirect-PFit-dPT-J4-expo"</span> <span class="ot">=</span> <span class="fu">quantile</span>(<span class="fu">apply</span>(smpl,<span class="dv">1</span>,prod),<span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)))</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  smpl <span class="ot">=</span> <span class="fu">as_draws_matrix</span>(med_model,<span class="at">variable=</span><span class="fu">c</span>(<span class="st">"b_J4_Pfit"</span>,<span class="st">"b_exPO_J4"</span>))</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  fe <span class="ot">=</span> <span class="fu">rbind</span>(fe,<span class="st">"indirect-PFit-J4-expo"</span> <span class="ot">=</span> <span class="fu">quantile</span>(<span class="fu">apply</span>(smpl,<span class="dv">1</span>,prod),<span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>)))</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fe)</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="fu">expand.grid</span>(<span class="at">n =</span> n_list,<span class="at">seed =</span> <span class="dv">1</span><span class="sc">:</span>n_sim))</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>sims <span class="ot">=</span> sims <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">brms=</span><span class="fu">list</span>(<span class="fu">runFun</span>(seed,n)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>is_significant <span class="ot">=</span> <span class="cf">function</span>(est){</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">mapply</span>(<span class="cf">function</span>(x,y)x<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">|</span> y<span class="sc">&lt;</span><span class="dv">0</span>, est[,<span class="dv">3</span>],est[,<span class="dv">4</span>])</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">as_tibble</span>(<span class="fu">t</span>(res)))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>sims2 <span class="ot">=</span> sims <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(n) <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">list</span>(<span class="fu">is_significant</span>(brms)))<span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="at">cols=</span><span class="fu">c</span>(sig))</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sims2,<span class="at">file=</span><span class="st">"2023-08-11_sims2.RDS"</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co">#q|&gt;gt()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>sims2 <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="at">file=</span><span class="st">"2023-08-07_sims2.RDS"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>ncols <span class="ot">=</span> <span class="fu">dim</span>(sims2)[<span class="dv">2</span>]</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> sims2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(n) <span class="sc">%&gt;%</span>   <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="dv">4</span><span class="sc">:</span>ncols<span class="dv">-1</span>, mean))</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">pivot_longer</span>(q,<span class="sc">-</span>n) <span class="sc">%&gt;%</span> <span class="fu">separate_wider_delim</span>(name,<span class="st">"_"</span>,<span class="at">names=</span><span class="fu">c</span>(<span class="st">"sink"</span>,<span class="st">"source"</span>))</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tmp,<span class="fu">aes</span>(<span class="at">x=</span>n,<span class="at">y=</span>value,<span class="at">color=</span>source,<span class="at">shape=</span>sink))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_path</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>sink)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="brms_powerAnalysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>